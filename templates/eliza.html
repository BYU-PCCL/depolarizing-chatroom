<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stylesheet.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com"> 
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;500&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
</head>
<body>
  <!-- add sounds -->
  <div class="flexwrap purple">
    <div class="chatwrapper">
      <div class="chat_heading">
        <h1 >{{prompt}}</h1>
      </div>
      <div class="chats">
      </div>

      <form class="chatform" action="" method="POST">
        <textarea class="message_box" placeholder="Chat with your group here!"></textarea>
        <input class="submit_chat" value="â†‘" type="submit"/>
      </form>
      <script>
      // submit on enter
      $(".message_box").keypress(function (e) {
          if(e.which == 13 && !e.shiftKey) {
              $(this).closest("form").submit();
              e.preventDefault();
          }
      });
      </script>
    </div>

  </div>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="{{ url_for('static', filename='js/elizabot/elizadata.js') }}"></script>
  <script src="{{ url_for('static', filename='js/elizabot/elizabot.js') }}"></script>
  <script type="text/javascript">
// scroll to bottom of chats
$(".chats").scrollTop($(".chats").prop("scrollHeight"));

// get last msg sender to see if need to update
var eliza = new ElizaBot();
eliza.memSize = 100;
var initial = eliza.getInitial();
var ecolor = "blue";

$('div.chats').append('<p class="uname received" style="color:'+ecolor+'">Eliza</p>');
$('div.chats').append('<p class="msg received" style="color:'+ecolor+'; border-color:'+ecolor+'">'+initial+'</p>');

$( 'form' ).on( 'submit', function( e ) {
  e.preventDefault();
  let user_input = $( 'textarea.message_box' ).val()
  if (user_input == ""){
    return;
  };
  // clear textarea
  $('.message_box').val('');

  // write user message
  $('div.chats').append('<p class="uname sent" style="color:{{color}}">{{uname}}</p>');
  $('div.chats').append('<p class="msg sent" style="color:{{color}}; border-color:{{color}}">'+user_input+'</p>');

  // write eliza message
  var reply = eliza.transform(user_input);
  $('div.chats').append('<p class="uname received" style="color:'+ecolor+'">Eliza</p>');
  $('div.chats').append('<p class="msg received" style="color:'+ecolor+'; border-color:'+ecolor+'">'+reply+'</p>');
  $(".chats").scrollTop($(".chats").prop("scrollHeight"));
});

  </script>
  <script src="{{ url_for('static', filename='js/chatroom.js') }}"></script>
</body>
</html>
